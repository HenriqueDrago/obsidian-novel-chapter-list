/*
THIS IS A GENERATED/BUNDLED FILE BY ESBUILD
if you want to view the source, please visit the github repository of this plugin
*/

var H=Object.defineProperty;var ee=Object.getOwnPropertyDescriptor;var te=Object.getOwnPropertyNames;var ne=Object.prototype.hasOwnProperty;var se=(d,e)=>{for(var t in e)H(d,t,{get:e[t],enumerable:!0})},ae=(d,e,t,n)=>{if(e&&typeof e=="object"||typeof e=="function")for(let a of te(e))!ne.call(d,a)&&a!==t&&H(d,a,{get:()=>e[a],enumerable:!(n=ee(e,a))||n.enumerable});return d};var re=d=>ae(H({},"__esModule",{value:!0}),d);var ce={};se(ce,{default:()=>O});module.exports=re(ce);var s=require("obsidian");var f=require("obsidian"),j={novelProjects:[{id:`default-${Date.now()}`,name:"My First Novel",path:"Novel/Chapters"}],propertyNameToChange:"status",propertyColumnHeader:"",propertyOptions:"To Do, Done, In Progress",chapterTemplatePath:"",otherGroupName:"Other",excludeOtherFromCount:!1};function ie(){return`novel-${Date.now()}-${Math.random().toString(36).slice(2,11)}`}var L=class extends f.PluginSettingTab{constructor(e,t){super(e,t),this.plugin=t}display(){let{containerEl:e}=this;e.empty(),e.createEl("h2",{text:"Novel Chapter Plugin Settings"}),new f.Setting(e).setName("Target Property Name").setDesc('The actual frontmatter key to update (e.g., "status", "outlineLevel"). This is case-sensitive.').addText(n=>n.setPlaceholder(j.propertyNameToChange).setValue(this.plugin.settings.propertyNameToChange).onChange(async a=>{this.plugin.settings.propertyNameToChange=a.trim(),await this.plugin.saveSettings(),this.plugin.refreshNovelChapterView()})),new f.Setting(e).setName("Property Column Header Display Name").setDesc('What title to display for the property column in the view (e.g., "Current Status"). If empty, it will use the "Target Property Name".').addText(n=>n.setPlaceholder("e.g., Status (optional)").setValue(this.plugin.settings.propertyColumnHeader).onChange(async a=>{this.plugin.settings.propertyColumnHeader=a.trim(),await this.plugin.saveSettings(),this.plugin.refreshNovelChapterView()})),new f.Setting(e).setName("Property Options").setDesc('Enter a comma-separated list of options for the dropdown (e.g., "To Do,In Progress,Complete").').addText(n=>n.setPlaceholder(j.propertyOptions).setValue(this.plugin.settings.propertyOptions).onChange(async a=>{this.plugin.settings.propertyOptions=a,await this.plugin.saveSettings(),this.plugin.refreshNovelChapterView()})),new f.Setting(e).setName("Chapter Template File Path").setDesc('Path to a markdown file to use as a template for new chapters (e.g., "Templates/ChapterTemplate.md"). Leave empty to not use a template. Placeholders like {{title}} and {{date}} can be used in the template.').addText(n=>n.setPlaceholder(j.chapterTemplatePath||"e.g., Templates/ChapterTemplate.md").setValue(this.plugin.settings.chapterTemplatePath).onChange(async a=>{this.plugin.settings.chapterTemplatePath=a.trim(),await this.plugin.saveSettings()})),new f.Setting(e).setName('Name for "Other" group').setDesc("Set a custom name for the group containing chapters not in a subfolder.").addText(n=>n.setPlaceholder("Other").setValue(this.plugin.settings.otherGroupName).onChange(async a=>{this.plugin.settings.otherGroupName=a||"Other",await this.plugin.saveSettings()})),new f.Setting(e).setName('Exclude "Other" group from total count').setDesc("If enabled, chapters in this group will not be included in the total chapter count at the top of the view.").addToggle(n=>n.setValue(this.plugin.settings.excludeOtherFromCount).onChange(async a=>{this.plugin.settings.excludeOtherFromCount=a,await this.plugin.saveSettings()})),e.createEl("hr"),e.createEl("h3",{text:"Novel Projects"});let t=e.createDiv({cls:"novel-projects-container"});this.renderNovelProjects(t),new f.Setting(e).setName("Add New Novel Project").setDesc("Add a new novel to track.").addButton(n=>n.setButtonText("Add Novel").setCta().onClick(async()=>{this.plugin.settings.novelProjects.push({id:ie(),name:`New Novel ${this.plugin.settings.novelProjects.length+1}`,path:""}),await this.plugin.saveSettings(),this.renderNovelProjects(t),this.plugin.refreshNovelChapterView(!0)}))}renderNovelProjects(e){e.empty(),this.plugin.settings.novelProjects.length===0&&e.createEl("p",{text:"No novel projects configured. Add one below."}),this.plugin.settings.novelProjects.forEach((t,n)=>{let a=new f.Setting(e).setName(`Novel ${n+1}`).setDesc(`Configuration for ${t.name||"this novel"}.`);a.addText(i=>i.setPlaceholder("Novel Name (e.g., My Epic Saga)").setValue(t.name).onChange(async l=>{t.name=l.trim(),await this.plugin.saveSettings(),this.plugin.refreshNovelChapterView(!0)})),a.addText(i=>i.setPlaceholder("Folder Path (e.g., Novels/MyEpicSaga/Chapters)").setValue(t.path).onChange(async l=>{t.path=l.trim(),await this.plugin.saveSettings(),this.plugin.refreshNovelChapterView(!0)})),a.addButton(i=>i.setIcon("trash").setTooltip("Remove this novel project").onClick(async()=>{this.plugin.settings.novelProjects.splice(n,1),await this.plugin.saveSettings(),this.renderNovelProjects(e),this.plugin.refreshNovelChapterView(!0)}))})}};var S="novel-chapter-view",oe={...j,lastSelectedNovelId:null,novelProjects:Array.isArray(j.novelProjects)&&j.novelProjects.length>0?j.novelProjects:[{id:`default-${Date.now()}`,name:"My First Novel",path:"Novel/Chapters"}]};function R(d,e){if(!e||e.trim()==="")return!1;let t=(0,s.normalizePath)(d.path),n=(0,s.normalizePath)(e);return n.endsWith("/")||(n+="/"),t.startsWith(n)}var le=d=>new Promise(e=>setTimeout(e,d)),B=class extends s.Modal{constructor(t,n,a){super(t);this.message=n;this.onConfirm=a}onOpen(){let{contentEl:t}=this;t.empty(),t.addClass("confirm-modal"),t.createEl("p",{text:this.message});let n=t.createDiv({cls:"modal-button-container"});new s.ButtonComponent(n).setButtonText("Confirm").setWarning().onClick(()=>{this.onConfirm(),this.close()}),new s.ButtonComponent(n).setButtonText("Cancel").onClick(()=>{this.close()})}onClose(){this.contentEl.empty()}},A=class extends s.Modal{constructor(t,n,a,i,l){super(t);this.result=null;this.modalTitle=n,this.ctaButtonText=a,this.initialValue=i,this.onSubmit=l}onOpen(){let{contentEl:t}=this;t.empty(),t.createEl("h2",{text:this.modalTitle});let n=t.createDiv({cls:"modal-input-container"}),a=new s.TextComponent(n).setPlaceholder("Chapter name").setValue(this.initialValue);a.inputEl.addClass("modal-text-input"),a.inputEl.focus();let i=t.createDiv({cls:"modal-button-container"}),l=new s.ButtonComponent(i).setButtonText(this.ctaButtonText).setCta(),u=()=>{let r=a.getValue().trim();r?(this.result=r,this.close(),this.onSubmit(this.result)):new s.Notice("Chapter name cannot be empty.")};l.onClick(u),new s.ButtonComponent(i).setButtonText("Cancel").onClick(()=>this.close()),a.inputEl.addEventListener("keypress",r=>{r.key==="Enter"&&(r.preventDefault(),u())})}onClose(){this.contentEl.empty()}},$=class extends s.ItemView{constructor(t,n){super(t);this.selectedNovelProjectId=null;this.searchTerm="";this.filterValue="all";this.plugin=n}getViewType(){return S}getDisplayText(){let t=this.plugin.settings.novelProjects.find(n=>n.id===this.selectedNovelProjectId);return t?`Chapters: ${t.name}`:"Novel Chapters"}getIcon(){return"list-ordered"}async onOpen(){let t=this.containerEl.children[1];t.empty(),t.addClass("novel-chapter-view-container"),this.controlsContainer=t.createDiv({cls:"novel-chapter-controls"}),this.tableContainer=t.createDiv({cls:"novel-chapter-table-container"}),await this.updateView(!0)}async onClose(){}async updateView(t=!1){if(t&&await this.renderControls(),!this.selectedNovelProjectId||!this.plugin.settings.novelProjects.find(n=>n.id===this.selectedNovelProjectId)){this.plugin.settings.lastSelectedNovelId&&this.plugin.settings.novelProjects.find(a=>a.id===this.plugin.settings.lastSelectedNovelId)?this.selectedNovelProjectId=this.plugin.settings.lastSelectedNovelId:this.plugin.settings.novelProjects.length>0?this.selectedNovelProjectId=this.plugin.settings.novelProjects[0].id:this.selectedNovelProjectId=null;let n=this.controlsContainer.querySelector("select.novel-project-selector");n&&this.selectedNovelProjectId?n.value=this.selectedNovelProjectId:n&&!this.selectedNovelProjectId&&this.plugin.settings.novelProjects.length>0&&(n.value=this.plugin.settings.novelProjects[0].id)}this.updateLeafDisplayText(),await this.renderChapterTable()}updateLeafDisplayText(){this.leaf&&this.leaf.setViewState(this.leaf.getViewState())}async renderControls(){this.controlsContainer.empty();let t=this.plugin.settings.novelProjects;if(t.length===0){this.controlsContainer.setText("No novel projects configured. Please add one in plugin settings."),this.selectedNovelProjectId=null;return}let n=this.controlsContainer.createDiv({cls:"novel-chapter-controls-line"}),a=this.controlsContainer.createDiv({cls:"novel-chapter-controls-line"}),i=n.createEl("select");i.addClass("novel-project-selector"),t.forEach(r=>{i.createEl("option",{text:r.name||"Unnamed Novel",value:r.id})}),this.selectedNovelProjectId&&t.find(r=>r.id===this.selectedNovelProjectId)?i.value=this.selectedNovelProjectId:t.length>0&&(this.selectedNovelProjectId=t[0].id,i.value=this.selectedNovelProjectId),i.addEventListener("change",async r=>{this.selectedNovelProjectId=r.target.value,this.plugin.settings.lastSelectedNovelId=this.selectedNovelProjectId,await this.plugin.saveSettings(),this.updateLeafDisplayText(),await this.renderChapterTable()}),new s.ButtonComponent(n).setIcon("chevron-left").setTooltip("Previous Chapter").onClick(()=>{let r=this.app.workspace.getActiveFile();if(!r){new s.Notice("Open a chapter file to use navigation.");return}let p=this.plugin.findProjectForFile(r);if(!p||p.id!==this.selectedNovelProjectId){new s.Notice("The active chapter doesn't belong to the selected project.");return}let h=this.plugin.getProjectChapters(p.path),c=h.findIndex(g=>g.path===r.path);c>0?this.app.workspace.openLinkText(h[c-1].path,"",!1):new s.Notice("This is the first chapter.")}),new s.ButtonComponent(n).setIcon("chevron-right").setTooltip("Next Chapter").onClick(()=>{let r=this.app.workspace.getActiveFile();if(!r){new s.Notice("Open a chapter file to use navigation.");return}let p=this.plugin.findProjectForFile(r);if(!p||p.id!==this.selectedNovelProjectId){new s.Notice("The active chapter doesn't belong to the selected project.");return}let h=this.plugin.getProjectChapters(p.path),c=h.findIndex(g=>g.path===r.path);c!==-1&&c<h.length-1?this.app.workspace.openLinkText(h[c+1].path,"",!1):new s.Notice("This is the last chapter.")}),new s.ButtonComponent(n).setIcon("plus").setTooltip("New Chapter").setClass("novel-chapter-new-button").onClick(async()=>{await this.plugin.promptAndCreateNewChapter(this.selectedNovelProjectId)}),new s.TextComponent(a).setPlaceholder("Search chapters...").setValue(this.searchTerm).onChange(r=>{this.searchTerm=r,this.renderChapterTable()}).inputEl.addClass("novel-chapter-search-input");let{propertyOptions:l}=this.plugin.settings,u=l.split(",").map(r=>r.trim()).filter(r=>r.length>0);if(u.length>0){let r=a.createEl("select");r.addClass("novel-chapter-filter-select"),r.createEl("option",{text:"Filter by property...",value:"all"}),u.forEach(p=>{r.createEl("option",{text:p,value:p})}),r.value=this.filterValue,r.addEventListener("change",p=>{this.filterValue=p.target.value,this.renderChapterTable()})}}async renderChapterTable(){var _,z;if(this.tableContainer.empty(),!this.selectedNovelProjectId)return;let t=this.plugin.settings.novelProjects.find(o=>o.id===this.selectedNovelProjectId);if(!t){this.tableContainer.setText("Selected novel project not found.");return}let{path:n}=t,{propertyNameToChange:a,propertyColumnHeader:i,propertyOptions:l}=this.plugin.settings,u=l.split(",").map(o=>o.trim()).filter(o=>o.length>0);if(!n||n.trim()===""){this.tableContainer.setText(`Project "${t.name}" has no folder path configured.`);return}let r=(0,s.normalizePath)(n),h=this.app.vault.getMarkdownFiles().filter(o=>R(o,r));if(this.filterValue!=="all"&&(h=h.filter(o=>{var w;let v=this.app.metadataCache.getFileCache(o);return((w=v==null?void 0:v.frontmatter)==null?void 0:w[a])===this.filterValue})),this.searchTerm&&(h=h.filter(o=>o.basename.toLowerCase().includes(this.searchTerm.toLowerCase()))),h.length===0){this.tableContainer.setText(`No chapters found in "${r}" matching your criteria.`);return}let c=this.plugin.settings.otherGroupName||"Other",g=new Map;for(let o of h){let v=r.endsWith("/")?r:`${r}/`,w=(0,s.normalizePath)(o.path).substring(v.length).split("/"),T=c;w.length>1&&(T=w[0]),g.has(T)||g.set(T,[]),(_=g.get(T))==null||_.push(o)}for(let o of g.values())o.sort((v,F)=>v.path.localeCompare(F.path));let b=Array.from(g.keys()).sort((o,v)=>o===c?1:v===c?-1:o.localeCompare(v)),D=h.length;this.plugin.settings.excludeOtherFromCount&&g.has(c)&&(D-=g.get(c).length);let G=this.tableContainer.createEl("table",{cls:"novel-chapter-table"}),K=1+(a&&u.length>0?1:0),W=G.createEl("thead").createEl("tr");if(W.createEl("th",{text:`Chapter (${D})`}),a&&u.length>0){let o=i.trim()||a;W.createEl("th",{text:o})}let M=G.createEl("tbody");for(let o of b){let v=g.get(o),F=`group-${o.replace(/[^a-zA-Z0-9]/g,"-")}`,w=M.createEl("tr",{cls:"chapter-group-header"}),T=w.createEl("td");T.colSpan=K;let U=T.createSpan({cls:"group-toggle-icon"});(0,s.setIcon)(U,"chevron-down"),T.createSpan({text:` ${o} (${v.length})`}),w.addEventListener("click",()=>{let m=w.classList.toggle("collapsed");(0,s.setIcon)(U,m?"chevron-right":"chevron-down"),M.querySelectorAll(`tr.chapter-data-row[data-group-id="${F}"]`).forEach(q=>{q.style.display=m?"none":""})});for(let m of v){let V=M.createEl("tr",{cls:"chapter-data-row"});V.dataset.groupId=F;let Y=V.createEl("td").createEl("a",{text:m.basename,href:"#",cls:"internal-link"});if(Y.addEventListener("click",I=>{I.preventDefault(),this.app.workspace.openLinkText(m.path,"",!1)}),Y.addEventListener("contextmenu",I=>{I.preventDefault();let P=new s.Menu;P.addItem(N=>N.setTitle("Rename").setIcon("pencil").onClick(()=>{this.plugin.promptAndRenameChapter(m)})),P.addItem(N=>N.setTitle("Delete").setIcon("trash").onClick(()=>{this.plugin.promptAndDeleteChapter(m)})),P.addSeparator(),P.addItem(N=>{N.setTitle("Move to...").setIcon("folder-move").onClick(()=>{var Z;let E=new s.Menu,x=[],y=this.app.vault.getAbstractFileByPath(r);if(y instanceof s.TFolder)for(let C of y.children)C instanceof s.TFolder&&x.push(C.path);x.sort();let k=this.plugin.settings.otherGroupName||"Other",X=((Z=m.parent)==null?void 0:Z.path)||"";E.addItem(C=>{C.setTitle(k).setIcon("folder-up").onClick(()=>{this.plugin.moveChapter(m,r)}),X===r&&C.setDisabled(!0)}),x.length>0&&E.addSeparator(),x.forEach(C=>{let Q=C.split("/").pop()||C;E.addItem(J=>{J.setTitle(Q).setIcon("folder").onClick(()=>{this.plugin.moveChapter(m,C)}),X===(0,s.normalizePath)(C)&&J.setDisabled(!0)})}),E.showAtMouseEvent(I)})}),P.showAtMouseEvent(I)}),a&&u.length>0){let P=V.createEl("td").createEl("select"),N=this.app.metadataCache.getFileCache(m),E=((z=N==null?void 0:N.frontmatter)==null?void 0:z[a])||"",x=P.createEl("option",{text:"--- Select ---",value:""});E||(x.selected=!0),u.forEach(y=>{let k=P.createEl("option",{text:y,value:y});y===E&&(k.selected=!0)}),P.addEventListener("change",async y=>{let k=y.target.value;await this.plugin.updateChapterProperty(m,a,k)})}}}}},O=class extends s.Plugin{getProjectChapters(e){if(!e||e.trim()==="")return[];let n=this.app.vault.getMarkdownFiles().filter(a=>R(a,e));return n.sort((a,i)=>a.path.localeCompare(i.path)),n}async moveChapter(e,t){let n=(0,s.normalizePath)(`${t}/${e.name}`);if(e.path===n){new s.Notice("Chapter is already in that folder.");return}if(await this.app.vault.adapter.exists(n)){new s.Notice(`A file named "${e.name}" already exists in the destination.`);return}try{await this.app.fileManager.renameFile(e,n),new s.Notice(`Moved "${e.basename}" successfully.`)}catch(a){console.error("Error moving chapter:",a),new s.Notice("Failed to move chapter. See console for details.")}}findProjectForFile(e){return e&&this.settings.novelProjects.find(t=>t.path&&R(e,t.path))||null}async updateChapterProperty(e,t,n){try{await this.app.fileManager.processFrontMatter(e,a=>{n===""?delete a[t]:a[t]=n}),new s.Notice(`Chapter '${e.basename}' ${t} updated.`)}catch(a){console.error(`Error updating frontmatter for ${e.path}:`,a),new s.Notice(`Failed to update ${t} for ${e.basename}.`)}}async promptAndRenameChapter(e){let t=e.basename;new A(this.app,"Rename Chapter","Rename",t,async n=>{n&&n!==t&&await this.renameChapter(e,n)}).open()}async renameChapter(e,t){let n=t.replace(/[\\/:*?"<>|]/g,"").trim();if(n===""){new s.Notice("Invalid chapter name provided.");return}if(!e.parent){new s.Notice("Cannot rename file: No parent folder found."),console.error("Could not find parent for file:",e.path);return}let a=`${e.parent.path}/${n}.md`;if(await this.app.vault.adapter.exists((0,s.normalizePath)(a))){new s.Notice(`A chapter named "${n}.md" already exists.`);return}try{await this.app.fileManager.renameFile(e,a),new s.Notice(`Chapter renamed to "${n}".`)}catch(i){console.error("Error renaming file:",i),new s.Notice("Failed to rename chapter. See console for details.")}}async promptAndDeleteChapter(e){new B(this.app,`Are you sure you want to delete "${e.basename}"? This will move the file to the trash.`,async()=>await this.deleteChapter(e)).open()}async deleteChapter(e){try{await this.app.vault.trash(e,!0),new s.Notice(`Chapter "${e.basename}" moved to trash.`)}catch(t){console.error("Error deleting file:",t),new s.Notice("Failed to delete chapter. See console for details.")}}async promptAndCreateNewChapter(e){var n;if(!e){new s.Notice("Please select a novel project first.");return}let t=this.settings.novelProjects.find(a=>a.id===e);if(!t||!((n=t.path)!=null&&n.trim())){new s.Notice("The selected project does not have a valid folder path configured.");return}new A(this.app,"Enter New Chapter Name","Create Chapter","",async a=>{var h;let i=a.replace(/[\\/:*?"<>|]/g,"").trim();if(i===""){new s.Notice("Invalid chapter name.");return}let l=(0,s.normalizePath)(t.path);if(!await this.app.vault.adapter.exists(l)){new s.Notice(`Project folder "${l}" does not exist.`);return}let u=(0,s.normalizePath)(`${l}/${i}.md`);if(await this.app.vault.adapter.exists(u)){new s.Notice(`A chapter named "${i}.md" already exists.`);return}let r="",p=(h=this.settings.chapterTemplatePath)==null?void 0:h.trim();if(p){let c=(0,s.normalizePath)(p),g=this.app.vault.getAbstractFileByPath(c);if(g instanceof s.TFile){r=await this.app.vault.read(g);let b=new Date,D=`${b.getFullYear()}-${String(b.getMonth()+1).padStart(2,"0")}-${String(b.getDate()).padStart(2,"0")}`;r=r.replace(/\{\{title\}\}/gi,a),r=r.replace(/\{\{date\}\}/gi,D)}else new s.Notice(`Template file not found at "${p}". Creating a default chapter.`)}if(r===""){let{propertyNameToChange:c}=this.settings;r=`---
title: ${a}
`,c&&(r+=`${c}: ""
`),r+=`---

# ${a}

`}try{await this.app.vault.create(u,r),new s.Notice(`Chapter "${a}" created successfully.`)}catch(c){console.error("Error creating new chapter:",c),new s.Notice("Failed to create new chapter. Check console for details.")}}).open()}async onload(){console.log("Novel Chapter Plugin loaded"),await this.loadSettings(),this.addSettingTab(new L(this.app,this)),this.registerView(S,e=>new $(e,this)),this.addCommand({id:"open-novel-chapter-view",name:"Open Novel Chapter View",callback:()=>this.activateView()}),this.addCommand({id:"add-new-chapter-to-project",name:"Novel Chapters: Create New Chapter in Project",callback:()=>{let e=this.settings.lastSelectedNovelId;if(!e&&this.settings.novelProjects.length===1&&(e=this.settings.novelProjects[0].id),!e){new s.Notice("Cannot determine project. Please select a project in the Novel Chapters view.");return}this.promptAndCreateNewChapter(e)}}),this.addCommand({id:"open-next-chapter-in-project",name:"Novel Chapters: Open Next Chapter",checkCallback:e=>{let t=this.app.workspace.getActiveFile();if(!t)return!1;let n=this.findProjectForFile(t);if(!n)return!1;if(e)return!0;let a=this.getProjectChapters(n.path),i=a.findIndex(l=>l.path===t.path);i!==-1&&i<a.length-1?this.app.workspace.openLinkText(a[i+1].path,"",!1):new s.Notice("This is the last chapter.")}}),this.addCommand({id:"open-previous-chapter-in-project",name:"Novel Chapters: Open Previous Chapter",checkCallback:e=>{let t=this.app.workspace.getActiveFile();if(!t)return!1;let n=this.findProjectForFile(t);if(!n)return!1;if(e)return!0;let a=this.getProjectChapters(n.path),i=a.findIndex(l=>l.path===t.path);i>0?this.app.workspace.openLinkText(a[i-1].path,"",!1):new s.Notice("This is the first chapter.")}}),this.addRibbonIcon("list-ordered","Open Novel Chapter View",()=>this.activateView()),this.registerEvent(this.app.vault.on("create",e=>this.handleFileChange(e))),this.registerEvent(this.app.vault.on("modify",e=>this.handleFileChange(e))),this.registerEvent(this.app.vault.on("delete",e=>this.handleFileChange(e))),this.registerEvent(this.app.vault.on("rename",(e,t)=>this.handleFileChange(e,t)))}onunload(){console.log("Novel Chapter Plugin unloaded"),this.app.workspace.detachLeavesOfType(S)}async loadSettings(){this.settings=Object.assign({},oe,await this.loadData()),(!Array.isArray(this.settings.novelProjects)||this.settings.novelProjects.length===0)&&(this.settings.novelProjects=[{id:`default-load-${Date.now()}`,name:"Default Novel",path:""}]),this.settings.novelProjects=this.settings.novelProjects.map(e=>({id:e.id||`generated-${Date.now()}`,name:e.name||"Unnamed Novel",path:e.path||""})),this.settings.lastSelectedNovelId&&!this.settings.novelProjects.find(e=>e.id===this.settings.lastSelectedNovelId)&&(this.settings.lastSelectedNovelId=this.settings.novelProjects.length>0?this.settings.novelProjects[0].id:null)}async saveSettings(){await this.saveData(this.settings),this.refreshNovelChapterView(!0)}refreshNovelChapterView(e=!1){this.app.workspace.getLeavesOfType(S).forEach(t=>{t.view instanceof $&&t.view.updateView(e)})}async handleFileChange(e,t){if(!(e instanceof s.TFile)||e.extension!=="md")return;this.settings.novelProjects.some(a=>{if(!a.path)return!1;let i=(0,s.normalizePath)(a.path),l=(0,s.normalizePath)(e.path).startsWith(i+"/"),u=t?(0,s.normalizePath)(t).startsWith(i+"/"):!1;return l||u})&&(await le(150),this.refreshNovelChapterView(!1))}async activateView(){var n;let{workspace:e}=this.app,t=e.getLeavesOfType(S)[0];t||(t=(n=e.getRightLeaf(!1))!=null?n:e.getLeaf("split","vertical"),await t.setViewState({type:S,active:!0})),e.revealLeaf(t)}};
